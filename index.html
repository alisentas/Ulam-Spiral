<!DOCTYPE html>
<html>
	<head>
		<title>Ulam Spiral</title>
		<style>
			canvas {
				border: 2px dashed lightblue;
			}
			* {
				font-family: helvetica;
			}
		</style>
		<meta charset="utf-8"/>
	</head>
	<body>
		<h1>Ulam Spiral <small>by Ali Şentaş</small></h1>
		<h2>Usage</h2>
		<p>
			Cube width is width of every colored prime number cubes withd, a value between 1-10 is recommenden.</br>
			Canvas width and height are obviously canvas size variables<br/>
			Count is the how many numbers should algorithm check for prime numbers, for example: if its 100, program will fill numbers between 1-100, not 100 prime numbers<br/>
			More information about Ulam Spirals can be found <strong><a href="http://en.wikipedia.org/wiki/Ulam_spiral">here</a></strong>
		</p>
		<label for="cubeWidth">Cube Width: </label><input type="number" id="cubeWidth" value="2"/><br/>
		<label for="width">Canvas Width: </label><input type="number" id="width" value="750" /><br/>
		<label for="height">Canvas Height: </label><input type="number" id="height" value="750" /><br/>
		<label for="count">Number Count: </label><input type="number" id="count" value="100000" /><br/>
		<button onclick="init()">Initialize</button><hr/>
		<canvas id="ulam" width="100" height="100">
			Your browser doesn't support canvas
		</canvas>
	</body>
	<script>
		var canvas = document.getElementById("ulam");
		var ctx = canvas.getContext("2d"), i;
		
		function init(){
			var	dir = "right";
			var turn = 0;
			var turns = 2;
			var turnRow = 0;
			var m;
			ctx.beginPath();
			var cubeWidth = parseInt(document.getElementById("cubeWidth").value, 10);
			var count = parseInt(document.getElementById("count").value,10);
			canvas.width = parseInt(document.getElementById("width").value,10);
			canvas.height = parseInt(document.getElementById("height").value,10);
			ctx.fillStyle = "black";
			
			//ctx.rect(canvas.width / 2, canvas.height / 2, cubeWidth, cubeWidth);
			ctx.rect(canvas.width / 2 + cubeWidth,canvas.height / 2, cubeWidth, cubeWidth);
			ctx.rect(canvas.width / 2 + cubeWidth,canvas.height / 2 - cubeWidth,cubeWidth,cubeWidth);
			curLoc = [canvas.width / 2 + cubeWidth,canvas.height / 2 - cubeWidth];
			isPrime = function(n) {
				if (n%1 || n<2) return false;
				if (n==leastFactor(n)) return true;
				return false;
			}

			leastFactor = function(n){
				if (isNaN(n) || !isFinite(n)) return NaN;  
				if (n==0) return 0;
				if (n%1 || n*n<2) return 1;
				if (n%2==0) return 2;
				if (n%3==0) return 3;
				if (n%5==0) return 5;
				m = Math.sqrt(n);
				for (var i=7;i<=m;i+=30) {
					if (n%i==0)      return i;
					if (n%(i+4)==0)  return i+4;
					if (n%(i+6)==0)  return i+6;
					if (n%(i+10)==0) return i+10;
					if (n%(i+12)==0) return i+12;
					if (n%(i+16)==0) return i+16;
					if (n%(i+22)==0) return i+22;
					if (n%(i+24)==0) return i+24;
				}
				return n;
			}
			
			ctx.beginPath();
			for(i = 4; i <= count; i++){
				switch(dir){
					case "right":
						turn++;
						if(turn == turns) {
							turnRow ++;
							dir = "down";
							turn = 0;
							if(turnRow == 2){
								turnRow = 0;
								turns++;
							}
						}
						curLoc[0] -= cubeWidth;
						if(isPrime(i)){
							ctx.rect(curLoc[0],curLoc[1],cubeWidth,cubeWidth);
						}
					break;
					case "down":
						turn++;
						if(turn == turns) {
							dir = "left";
							turn = 0;
							turnRow ++;
							if(turnRow == 2){
								turnRow = 0;
								turns++;
							}
						}
						curLoc[1] += cubeWidth;
						if(isPrime(i)){
							ctx.rect(curLoc[0],curLoc[1],cubeWidth,cubeWidth);
						}
					break;
					case "left":
						turn++;
						if(turn == turns) {
							dir = "up";
							turn = 0;
							turnRow ++;
							if(turnRow == 2){
								turnRow = 0;
								turns++;
							}
						}
						curLoc[0] += cubeWidth;
						if(isPrime(i)){
							ctx.rect(curLoc[0],curLoc[1],cubeWidth,cubeWidth);
						}
					break;
					case "up":
						turn++;
						if(turn == turns) {
							dir = "right";
							turn = 0;
							turnRow ++;
							if(turnRow == 2){
								turnRow = 0;
								turns++;
							}
						}
						curLoc[1] -= cubeWidth;
						if(isPrime(i)){
							ctx.rect(curLoc[0],curLoc[1],cubeWidth,cubeWidth);
						}
					break;
				}
			}
			ctx.fill();
		}
	</script>
</html>